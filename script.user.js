// ==UserScript==
// @name         网页截屏
// @namespace    https://github.com/CListery
// @version      0.9
// @description  将选中元素截屏
// @license      MIT
// @author       CListery
// @require      https://cdn.jsdelivr.net/npm/html2canvas@1/dist/html2canvas.min.js
// @require      https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js
// @require      https://cdn.jsdelivr.net/npm/luna-dom-highlighter@1.0.2/luna-dom-highlighter.js
// @resource     lunaDomHighlighterCSS  https://cdn.jsdelivr.net/npm/luna-dom-highlighter/luna-dom-highlighter.css
// @match        *://*/*
// @icon         data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjZmZmZmZmIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMuMiIvPgogICAgPHBhdGggZD0iTTkgMkw3LjE3IDRINGMtMS4xIDAtMiAuOS0yIDJ2MTJjMCAxLjEuOSAyIDIgMmgxNmMxLjEgMCAyLS45IDItMlY2YzAtMS4xLS45LTItMi0yaC0zLjE3TDE1IDJIOXptMyAxNWMtMi43NiAwLTUtMi4yNC01LTVzMi4yNC01IDUtNSA1IDIuMjQgNSA1LTIuMjQgNS01IDV6Ii8+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo=
// @grant        GM.getResourceUrl
// @grant        GM.getResourceText
// @grant        GM_getResourceText
// @downloadURL https://update.greasyfork.org/scripts/493588/%E7%BD%91%E9%A1%B5%E6%88%AA%E5%B1%8F.user.js
// @updateURL https://update.greasyfork.org/scripts/493588/%E7%BD%91%E9%A1%B5%E6%88%AA%E5%B1%8F.meta.js
// ==/UserScript==

!function(){var t,e;let n,r;t=this,e=function(){var t={};"object"==typeof window&&window._licia&&(t=window._licia);var e,n,r,i,o,u=t.last=function(t){var e=t?t.length:0;if(e)return t[e-1]},a=t.isUndef=function(t){return void 0===t},c=(t.types={},t.isObj=function(t){var e=typeof t;return!!t&&("function"===e||"object"===e)}),s=t.splitCase=(e=/([A-Z])/g,n=/[_.\- ]+/g,r=/(^-)|(-$)/g,function(t){return(t=t.replace(e,"-$1").toLowerCase().replace(n,"-").replace(r,"")).split("-")}),l=t.camelCase=function(t){function e(t,e){this[e]=t.replace(/\w/,(function(t){return t.toUpperCase()}))}return function(t){var n=s(t),r=n[0];return n.shift(),n.forEach(e,n),r+=n.join("")}}(),f=t.kebabCase=function(t){return s(t).join("-")},d=t.has=(i=Object.prototype.hasOwnProperty,function(t,e){return i.call(t,e)}),p=t.keys=Object.keys?Object.keys:function(t){var e=[];for(var n in t)d(t,n)&&e.push(n);return e},h=t.idxOf=function(t,e,n){return Array.prototype.indexOf.call(t,e,n)},v=t.create=function(t){t=function(t){if(!c(t))return{};if(e)return e(t);function n(){}return n.prototype=t,new n};var e=Object.create;return t}({}),m=t.inherits=(o={},o=function(t,e){t.prototype=v(e.prototype)},o),g=t.memoize=function(t){return t=function(t,e){var n=function(r){var i=n.cache,o=""+(e?e.apply(this,arguments):r);return d(i,o)||(i[o]=t.apply(this,arguments)),i[o]};return n.cache={},n},t}({});t.cssSupports=function(t){t=g((function(t,n){return a(n)?(t=l(t),!a(e[t])):(e.cssText="",e.cssText=t+":"+n,!!e.length)}),(function(t,e){return t+" "+e}));var e=document.createElement("p").style;return t}({});var y=t.optimizeCb=function(t){return t=function(t,e,n){if(a(e))return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)}}return function(){return t.apply(e,arguments)}},t}({});t.evalCss=function(t){var e=document.createElement("style");return e.textContent=t,e.type="text/css",document.head.appendChild(e),e};var w,b,x,C,I=t.isEl=function(t){return!(!t||1!==t.nodeType)},M=t.startWith=function(t){return t=function(t,e){return 0===t.indexOf(e)},t}({}),j=t.identity=function(t){return t},A=t.objToStr=(w=Object.prototype.toString,function(t){return w.call(t)}),S=t.isArr=Array.isArray?Array.isArray:function(t){return"[object Array]"===A(t)},E=t.castPath=function(t){t=function(t,r){if(S(t))return t;if(r&&d(r,t))return[t];var i=[];return t.replace(e,(function(t,e,r,o){i.push(r?o.replace(n,"$1"):e||t)})),i};var e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,n=/\\(\\)?/g;return t}({}),L=t.safeGet=function(t,e){var n;for(n=(e=E(e,t)).shift();!a(n);){if(null==(t=t[n]))return;n=e.shift()}return t},T=t.isFn=function(t){var e=A(t);return"[object Function]"===e||"[object GeneratorFunction]"===e||"[object AsyncFunction]"===e},k=t.getProto=(b=Object.getPrototypeOf,x={}.constructor,function(t){if(c(t)){if(b)return b(t);var e=t.__proto__;return e||null===e?e:T(t.constructor)?t.constructor.prototype:t instanceof x?x.prototype:void 0}}),_=t.isMiniProgram="undefined"!=typeof wx&&T(wx.openLocation),P=t.isNum=function(t){return"[object Number]"===A(t)},N=t.isArrLike=(C=Math.pow(2,53)-1,function(t){if(!t)return!1;var e=t.length;return P(e)&&e>=0&&e<=C&&!T(t)}),O=t.each=function(t,e,n){var r,i;if(e=y(e,n),N(t))for(r=0,i=t.length;r<i;r++)e(t[r],r,t);else{var o=p(t);for(r=0,i=o.length;r<i;r++)e(t[o[r]],o[r],t)}return t},z=t.createAssigner=function(t){return t=function(t,e){return function(n){return O(arguments,(function(r,i){if(0!==i){var o=t(r);O(o,(function(t){e&&!a(n[t])||(n[t]=r[t])}))}})),n}},t}({}),$=t.extendOwn=z(p),D=t.values=function(t){var e=[];return O(t,(function(t){e.push(t)})),e},H=t.isStr=function(t){return"[object String]"===A(t)},R=t.contain=function(t,e){return H(t)?t.indexOf(e)>-1:(N(t)||(t=D(t)),h(t,e)>=0)},B=t.isBrowser="object"==typeof window&&"object"==typeof document&&9===document.nodeType,G=t.isMatch=function(t,e){var n=p(e),r=n.length;if(null==t)return!r;t=Object(t);for(var i=0;i<r;i++){var o=n[i];if(e[o]!==t[o]||!(o in t))return!1}return!0},Z=t.matcher=function(t){return t=$({},t),function(e){return G(e,t)}},F=t.restArgs=function(t){return t=function(t,e){return e=null==e?t.length-1:+e,function(){var n,r=Math.max(arguments.length-e,0),i=new Array(r);for(n=0;n<r;n++)i[n]=arguments[n+e];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,arguments[0],i);case 2:return t.call(this,arguments[0],arguments[1],i)}var o=new Array(e+1);for(n=0;n<e;n++)o[n]=arguments[n];return o[e]=i,t.apply(this,o)}},t}({}),U=t.mergeArr=F((function(t,e){for(var n=t.length,r=0,i=e.length;r<i;r++)for(var o=e[r],u=0,a=o.length;u<a;u++)t[n++]=o[u];return t.length=n,t})),V=t.upperFirst=function(t){return t.length<1?t:t[0].toUpperCase()+t.slice(1)},W=t.prefix=function(t){(t=g((function(t){if(t=t.replace(n,""),t=l(t),d(r,t))return t;for(var i=e.length;i--;){var o=e[i]+V(t);if(d(r,o))return o}return t}))).dash=g((function(e){var r=t(e);return(n.test(r)?"-":"")+f(r)}));var e=["O","ms","Moz","Webkit"],n=/^(O)|(ms)|(Moz)|(Webkit)|(-o-)|(-ms-)|(-moz-)|(-webkit-)/g,r=document.createElement("p").style;return t}({}),X=t.property=function(t){return S(t)?function(e){return L(e,t)}:(e=t,function(t){return null==t?void 0:t[e]});var e},Y=t.safeCb=function(t,e,n){return null==t?j:T(t)?y(t,e,n):c(t)&&!S(t)?Z(t):X(t)},J=t.filter=function(t,e,n){var r=[];return e=Y(e,n),O(t,(function(t,n,i){e(t,n,i)&&r.push(t)})),r},Q=t.unique=function(t){function e(t,e){return t===e}return function(t,n){return n=n||e,J(t,(function(t,e,r){for(var i=r.length;++e<i;)if(n(t,r[e]))return!1;return!0}))}}(),q=t.allKeys=function(t){var e=Object.getOwnPropertyNames,n=Object.getOwnPropertySymbols;return t=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.prototype,o=void 0===i||i,u=r.unenumerable,a=void 0!==u&&u,c=r.symbol,s=void 0!==c&&c,l=[];if((a||s)&&e){var f=p;a&&e&&(f=e);do{l=l.concat(f(t)),s&&n&&(l=l.concat(n(t)))}while(o&&(t=k(t))&&t!==Object.prototype);l=Q(l)}else if(o)for(var d in t)l.push(d);else l=p(t);return l},t}({});t.defaults=z(q,!0);var K=t.extend=z(q),tt=t.map=function(t,e,n){e=Y(e,n);for(var r=!N(t)&&p(t),i=(r||t).length,o=Array(i),u=0;u<i;u++){var a=r?r[u]:u;o[u]=e(t[a],a,t)}return o},et=t.toArr=function(t){return t?S(t)?t:N(t)&&!H(t)?tt(t):[t]:[]},nt=t.Class=function(t){var e=(t=function(t,n){return e.extend(t,n)}).Base=function t(e,n,r){r=r||{};var i=n.className||L(n,"initialize.name")||"";delete n.className;var o=function(){var t=et(arguments);return this.initialize&&this.initialize.apply(this,t)||this};if(!_)try{o=new Function("toArr","return function "+i+"(){var args = toArr(arguments);return this.initialize ? this.initialize.apply(this, args) || this : this;};")(et)}catch(t){}return m(o,e),o.prototype.constructor=o,o.extend=function(e,n){return t(o,e,n)},o.inherits=function(t){m(o,t)},o.methods=function(t){return K(o.prototype,t),o},o.statics=function(t){return K(o,t),o},o.methods(n).statics(r),o}(Object,{className:"Base",callSuper:function(t,e,n){return t.prototype[e].apply(this,n)},toString:function(){return this.constructor.name}});return t}({}),rt=t.Select=function(t){var e=new(t=nt({className:"Select",initialize:function(t){return this.length=0,t?H(t)?e.find(t):void(t.nodeType&&(this[0]=t,this.length=1)):this},find:function(e){var n=new t;return this.each((function(){U(n,this.querySelectorAll(e))})),n},each:function(t){return O(this,(function(e,n){t.call(e,n,e)})),this}}))(document);return t}({}),it=t.$safeEls=function(t){return et(H(t)?new rt(t):t)},ot=t.$attr=function(t){return(t=function(t,e,n){if(t=it(t),a(n)&&H(e))return function(t,e){return t.getAttribute(e)}(t[0],e);var r=e;c(r)||((r={})[e]=n),function(t,e){O(t,(function(t){O(e,(function(e,n){t.setAttribute(n,e)}))}))}(t,r)}).remove=function(t,e){t=it(t),e=et(e),O(t,(function(t){O(e,(function(e){t.removeAttribute(e)}))}))},t}({}),ut=t.$css=function(t){t=function(t,n,r){if(t=it(t),a(r)&&H(n))return function(t,e){return t.style[W(e)]||getComputedStyle(t,"").getPropertyValue(e)}(t[0],n);var i=n;c(i)||((i={})[n]=r),function(t,n){O(t,(function(t){var r=";";O(n,(function(t,n){n=W.dash(n),r+=n+":"+function(t,n){return P(n)&&!R(e,f(t))?n+"px":n}(n,t)+";"})),t.style.cssText+=r}))}(t,i)};var e=["column-count","columns","font-weight","line-weight","opacity","z-index","zoom"];return t}({}),at=t.$data=function(t,e,n){var r=e;return H(e)&&(r="data-"+e),c(e)&&(r={},O(e,(function(t,e){r["data-"+e]=t}))),ot(t,r,n)},ct=t.$insert=function(t){function e(t){return function(e,n){e=it(e),O(e,(function(e){if(H(n))e.insertAdjacentHTML(t,n);else{var r=e.parentNode;switch(t){case"beforebegin":r&&r.insertBefore(n,e);break;case"afterend":r&&r.insertBefore(n,e.nextSibling);break;case"beforeend":e.appendChild(n);break;case"afterbegin":e.prepend(n);break}}}))}}return{before:e("beforebegin"),after:e("afterend"),append:e("beforeend"),prepend:e("afterbegin")}}(),st=t.$offset=function(t){var e=(t=it(t))[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:Math.round(e.width),height:Math.round(e.height)}},lt=t.$property=function(t){function e(t){return function(e,n){var r=(e=it(e))[0];if(a(n))return r?r[t]:"";r&&O(e,(function(e){e[t]=n}))}}return{html:e("innerHTML"),text:e("textContent"),val:e("value")}}(),ft=t.$remove=function(t){t=it(t),O(t,(function(t){var e=t.parentNode;e&&e.removeChild(t)}))},dt=t.$show=function(t){t=function(t){t=it(t),O(t,(function(t){(function(t){return"none"==getComputedStyle(t,"").getPropertyValue("display")})(t)&&(t.style.display=function(t){var n,r;return e[t]||(n=document.createElement(t),document.documentElement.appendChild(n),r=getComputedStyle(n,"").getPropertyValue("display"),n.parentNode.removeChild(n),"none"==r&&(r="block"),e[t]=r),e[t]}(t.nodeName))}))};var e={};return t}({}),pt=t.delegate=function(t){function e(){return!0}function n(){return!1}function r(e){var n,r=this.events[e.type],o=i.call(this,e,r);e=new t.Event(e);for(var u,a,c=0;(a=o[c++])&&!e.isPropagationStopped();)for(e.curTarget=a.el,u=0;(n=a.handlers[u++])&&!e.isImmediatePropagationStopped();)!1===n.handler.apply(a.el,[e])&&(e.preventDefault(),e.stopPropagation())}function i(t,e){var n,r,i,o,u=t.target,a=[],c=e.delegateCount;if(u.nodeType)for(;u!==this;u=u.parentNode||this){for(r=[],o=0;o<c;o++)void 0===r[n=(i=e[o]).selector+" "]&&(r[n]=R(this.querySelectorAll(n),u)),r[n]&&r.push(i);r.length&&a.push({el:u,handlers:r})}return c<e.length&&a.push({el:this,handlers:e.slice(c)}),a}return t={add:function(t,e,n,i){var o,u={selector:n,handler:i};t.events||(t.events={}),(o=t.events[e])||((o=t.events[e]=[]).delegateCount=0,t.addEventListener(e,(function(){r.apply(t,arguments)}),!1)),n?o.splice(o.delegateCount++,0,u):o.push(u)},remove:function(t,e,n,r){var i=t.events;if(i&&i[e])for(var o,u=i[e],a=u.length;a--;)o=u[a],n&&o.selector!=n||o.handler!=r||(u.splice(a,1),o.selector&&u.delegateCount--)},Event:nt({className:"Event",initialize:function(t){this.origEvent=t},isDefaultPrevented:n,isPropagationStopped:n,isImmediatePropagationStopped:n,preventDefault:function(){var t=this.origEvent;this.isDefaultPrevented=e,t&&t.preventDefault&&t.preventDefault()},stopPropagation:function(){var t=this.origEvent;this.isPropagationStopped=e,t&&t.stopPropagation&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.origEvent;this.isImmediatePropagationStopped=e,t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),this.stopPropagation()}})},t}({}),ht=t.$event=function(t){function e(t){return function(e,n,r,i){e=it(e),a(i)&&(i=r,r=void 0),O(e,(function(e){pt[t](e,n,r,i)}))}}return{on:e("add"),off:e("remove")}}(),vt=t.some=function(t,e,n){e=Y(e,n);for(var r=!N(t)&&p(t),i=(r||t).length,o=0;o<i;o++){var u=r?r[o]:o;if(e(t[u],u,t))return!0}return!1},mt=t.$class=function(t){function e(t){return H(t)?t.split(/\s+/):et(t)}return t={add:function(n,r){n=it(n);var i=e(r);O(n,(function(e){var n=[];O(i,(function(r){t.has(e,r)||n.push(r)})),0!==n.length&&(e.className+=(e.className?" ":"")+n.join(" "))}))},has:function(t,e){t=it(t);var n=new RegExp("(^|\\s)"+e+"(\\s|$)");return vt(t,(function(t){return n.test(t.className)}))},toggle:function(e,n){e=it(e),O(e,(function(e){if(!t.has(e,n))return t.add(e,n);t.remove(e,n)}))},remove:function(t,n){t=it(t);var r=e(n);O(t,(function(t){O(r,(function(e){t.classList.remove(e)}))}))}}}({});return t.$=function(t){t=function(t){return new rt(t)},rt.methods({offset:function(){return st(this)},hide:function(){return this.css("display","none")},show:function(){return dt(this),this},first:function(){return t(this[0])},last:function(){return t(u(this))},get:function(t){return this[t]},eq:function(e){return t(this[e])},on:function(t,e,n){return ht.on(this,t,e,n),this},off:function(t,e,n){return ht.off(this,t,e,n),this},html:function(t){var e=lt.html(this,t);return a(t)?e:this},text:function(t){var e=lt.text(this,t);return a(t)?e:this},val:function(t){var e=lt.val(this,t);return a(t)?e:this},css:function(t,n){var r=ut(this,t,n);return e(t,n)?r:this},attr:function(t,n){var r=ot(this,t,n);return e(t,n)?r:this},data:function(t,n){var r=at(this,t,n);return e(t,n)?r:this},rmAttr:function(t){return ot.remove(this,t),this},remove:function(){return ft(this),this},addClass:function(t){return mt.add(this,t),this},rmClass:function(t){return mt.remove(this,t),this},toggleClass:function(t){return mt.toggle(this,t),this},hasClass:function(t){return mt.has(this,t)},parent:function(){return t(this[0].parentNode)},append:function(t){return ct.append(this,t),this},prepend:function(t){return ct.prepend(this,t),this},before:function(t){return ct.before(this,t),this},after:function(t){return ct.after(this,t),this}});var e=function(t,e){return a(e)&&H(t)};return t}({}),t.h=function(t){function e(t){for(var e="div",n="",r=[],i=[],o="",u=0,a=t.length;u<a;u++){var c=t[u];"#"===c||"."===c?(i.push(o),o=c):o+=c}i.push(o);for(var s=0,l=i.length;s<l;s++)(o=i[s])&&(M(o,"#")?n=o.slice(1):M(o,".")?r.push(o.slice(1)):e=o);return{tagName:e,id:n,classes:r}}return t=function(t,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];(I(n)||H(n))&&(i.unshift(n),n=null),n||(n={});var u=e(t),a=u.tagName,c=u.id,s=u.classes,l=document.createElement(a);return c&&l.setAttribute("id",c),mt.add(l,s),O(i,(function(t){H(t)?l.appendChild(document.createTextNode(t)):I(t)&&l.appendChild(t)})),O(n,(function(t,e){H(t)?l.setAttribute(e,t):T(t)&&M(e,"on")?l.addEventListener(e.slice(2),t,!1):"style"===e&&ut(l,t)})),l},t}({}),t.root=B?window:global,t.toBool=function(t){return H(t)?"0"!==(t=t.toLowerCase())&&""!==t&&"false"!==t:!!t},t},"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t._licia=e();let i,o=!1,u=!1;const a=_licia.cssSupports("clip-path","polygon(50% 0px, 0px 100%, 100% 100%)"),c="ontouchstart"in _licia.root;const s=_licia.h("div",{class:"__chobitsu-hide__",style:{position:"fixed",right:0,top:0,background:"#fff",fontSize:13,opacity:.5,padding:"4px 6px"}});function l(){0}_licia.$(s);function f(t){if(1===t.nodeType){const e=t.getAttribute("class")||"";if(_licia.contain(e,"__chobitsu-hide__")||_licia.contain(e,"html2canvas-container"))return!1}const e=!(3===t.nodeType&&""===trim(t.nodeValue||""));return e&&t.parentNode?f(t.parentNode):e}function d(t){const e=function(t){if(c){const e=t.touches[0]||t.changedTouches[0];return document.elementFromPoint(e.clientX,e.clientY)}return document.elementFromPoint(t.clientX,t.clientY)}(t);e&&f(e)&&(1!==e.nodeType&&3!==e.nodeType||(_licia.defaults(r,{contentColor:"transparent",paddingColor:"transparent",borderColor:"transparent",marginColor:"transparent"}),a||_licia.extend(r,{showInfo:!1}),n.highlight(e,r)))}function p(){n.hide()}function h(t){window.disableHighlight(),$("#cancelhtml2canvas").text("正在生成截图..."),html2canvas(t.target,{scale:3,allowTaint:!0,useCORS:!0}).then((t=>{t.toBlob((function(t){let e=window.URL.createObjectURL(t);window.open(e),setTimeout((()=>{document.onkeydown=window.keydown_listener}),0),$("#tryhtml2canvas").show(),$("#cancelhtml2canvas").hide()}))}))}function v(t,e){document.documentElement.addEventListener(t,e,!0)}function m(t,e){document.documentElement.removeEventListener(t,e,!0)}window.enableHighlight=function(){!function(){if(u)return;let t=_licia.h("div",{class:"__chobitsu-hide__",style:{all:"initial"}});i=_licia.$(t),document.documentElement.appendChild(t);let e=null,c=null;if(t.attachShadow?c=t.attachShadow({mode:"open"}):t.createShadowRoot&&(c=t.createShadowRoot()),c){"undefined"==typeof GM_getResourceText&&(GM.getResourceText=GM_getResourceText=async function(t){let e=await(await fetch(await GM.getResourceUrl(t))).text(),n=await GM.getValue(t);return void 0!==n?n:(GM.setValue(t,e),e)});const t=GM_getResourceText("lunaDomHighlighterCSS").replace("/*# sourceMappingURL=luna-dom-highlighter.css.map*/",""),n=document.createElement("style");n.textContent=t,n.type="text/css",c.appendChild(n),e=document.createElement("div"),c.appendChild(e)}else e=document.createElement("div"),t.appendChild(e),o||(_licia.evalCss(css),o=!0);r={showRulers:!1,showExtensionLines:!1,contrastAlgorithm:"aa",showInfo:a,showStyles:!0,showAccessibilityInfo:!1,colorFormat:"hex",contentColor:"rgba(111, 168, 220, .66)",paddingColor:"rgba(147, 196, 125, .55)",borderColor:"rgba(255, 229, 153, .66)",marginColor:"rgba(246, 178, 107, .66)",monitorResize:_licia.toBool(_licia.root.ResizeObserver)},n=new LunaDomHighlighter(e,r),window.addEventListener("resize",l),u=!0}(),v("mousemove",d),v("mouseout",p),v("click",h)},window.disableHighlight=function(){u&&(n.destroy(),i.remove(),window.removeEventListener("resize",l),m("mousemove",d),m("mouseout",p),m("click",h),u=!1)},window.captureHTML=()=>{setTimeout((()=>{window.keydown_listener=document.onkeydown,document.onkeydown=t=>{27===(window.event?t.keyCode:t.which)&&(window.disableHighlight(),setTimeout((()=>{document.onkeydown=window.keydown_listener}),0),$("#tryhtml2canvas").show(),$("#cancelhtml2canvas").hide())},window.enableHighlight()}),0),$("#cancelhtml2canvas").text("按 ESC 取消截图"),$("#cancelhtml2canvas").show(),$("#tryhtml2canvas").hide()};let g=document.createElement("div");g.innerHTML='\n    <div id="tryhtml2canvas"\n      style="background-image: linear-gradient(0deg, #558b2f, #7cb342);cursor: pointer; opacity: 0.7; position: fixed;display: flex;bottom: 40px;right: 40px;z-index: 100001;width: 50px;height: 50px;border-radius: 50%;box-shadow: 0 2px 2px 0 rgba(0,0,0,0.14), 0 1px 5px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.2);-webkit-box-pack: center;-webkit-justify-content: center;-webkit-box-align: center;-webkit-align-items: center;">\n      <div style="overflow: hidden;">\n        <img\n          src="data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjZmZmZmZmIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMuMiIvPgogICAgPHBhdGggZD0iTTkgMkw3LjE3IDRINGMtMS4xIDAtMiAuOS0yIDJ2MTJjMCAxLjEuOSAyIDIgMmgxNmMxLjEgMCAyLS45IDItMlY2YzAtMS4xLS45LTItMi0yaC0zLjE3TDE1IDJIOXptMyAxNWMtMi43NiAwLTUtMi4yNC01LTVzMi4yNC01IDUtNSA1IDIuMjQgNSA1LTIuMjQgNS01IDV6Ii8+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo="\n          alt="Try html2canvas" style="transform: translateX(-210px); filter: drop-shadow(210px 0 0 black);">\n      </div>\n    </div>\n    ',document.body.appendChild(g);let y=document.createElement("div");y.innerHTML='\n    <div id="cancelhtml2canvas"\n      style="background-color: rgba(170, 170, 170, 0.8); cursor: pointer; position: fixed; display: none; bottom: 40px; right: 40px; z-index: 100001; padding: 10px; font-size: 20px; color: darkred; box-shadow: rgba(0, 0, 0, 0.14) 0px 2px 2px 0px, rgba(0, 0, 0, 0.12) 0px 1px 5px 0px, rgba(0, 0, 0, 0.2) 0px 3px 1px -2px; -webkit-box-pack: center; justify-content: center; -webkit-box-align: center; align-items: center;">\n      <div style="overflow: hidden;">按 ESC 取消截图</div>\n    </div>\n    ',document.body.appendChild(y);let w=g.querySelector("#tryhtml2canvas");w.onmouseenter=()=>{w.style.opacity=1},w.onmouseleave=()=>{w.style.opacity=.7};let b,x,C,I,M=!1;const j=t=>{if(!M)return;const e=t.clientX,n=t.clientY,r=e-b,i=n-x;(Math.abs(r)>5||Math.abs(i)>5)&&(w.style.left=e-C+"px",w.style.top=n-I+"px",w.removeEventListener("click",window.captureHTML))},A=t=>{M&&(M=!1,w.style.cursor="pointer",setTimeout((()=>{w.addEventListener("click",window.captureHTML)}),0),document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",A))};w.addEventListener("mousedown",(t=>{M=!0,b=t.clientX,x=t.clientY,C=b-w.getBoundingClientRect().left,I=x-w.getBoundingClientRect().top,w.style.cursor="grabbing",document.addEventListener("mousemove",j),document.addEventListener("mouseup",A)})),w.addEventListener("click",window.captureHTML)}();